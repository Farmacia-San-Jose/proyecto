infor = request.body
            data = json.loads(infor.decode('utf-8'))
            validar = data.get('validar')
        
            lista = data.get('lista', [])
            user_id = request.user.id        
            transaction_type = data.get('transaction_type')
            transaction_date = data.get('transaction_date')
            if validar:
                for contenido in lista:
                    for elementos in contenido:
                        #{'cantidad': '1', 'medicine_id': 15, 'sale_price': '5.50'}
                        transaccion = HistorialTransaccion()

                        transaccion.transaction_type = transaction_type
                        transaccion.transaction_date = transaction_date
                        user = get_object_or_404(User, id=user_id)
                        transaccion.user_id = user
                        transaccion.total = 0
                        transaccion.save()




                        detalle_transaccion = DetalleTransaccion()   
                        transaccion_id = get_object_or_404(HistorialTransaccion, id=transaccion.id)                 
                        medicamento_id = get_object_or_404(Medicamento, id = elementos["medicine_id"])
                        
                        detalle_transaccion.transaction_id = transaccion_id
                        detalle_transaccion.medicine_id = medicamento_id
                        detalle_transaccion.quantity = elementos["cantidad"]
                        detalle_transaccion.price = elementos["sale_price"]
                        detalle_transaccion.subtotal = 0
                        detalle_transaccion.save()
                return redirect('index')
            return redirect('transactions:realizar_transaccion')


                    